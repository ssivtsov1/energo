drop table eqm_compens35;
create table eqm_compens35
(id int,kod varchar(5),name varchar(50),res int, primary key (id) );

insert into eqm_compens35(id,kod,name,res) values(100,'1Ч','Подус?вка',310);
insert into eqm_compens35(id,kod,name,res) values(105,'2Ч','Центральна',310);
insert into eqm_compens35(id,kod,name,res) values(110,'3Ч','Ял?вщина',310);
insert into eqm_compens35(id,kod,name,res) values(115,'4Ч','Л?сковиця',310);
insert into eqm_compens35(id,kod,name,res) values(120,'5Ч','Придеснянська',310);
insert into eqm_compens35(id,kod,name,res) values(125,'6Ч','Коти',310);
insert into eqm_compens35(id,kod,name,res) values(130,'7Ч','ЗАЗ',310);
insert into eqm_compens35(id,kod,name,res) values(135,'8С','Нерафа',250);
insert into eqm_compens35(id,kod,name,res) values(140,'9С','Пакуль',320);
insert into eqm_compens35(id,kod,name,res) values(145,'10С','Мньов',320);
insert into eqm_compens35(id,kod,name,res) values(150,'11С','Павл?вка',250);
insert into eqm_compens35(id,kod,name,res) values(155,'12С','Стройплощ.',330);
insert into eqm_compens35(id,kod,name,res) values(160,'13С','Р?пки',250);
insert into eqm_compens35(id,kod,name,res) values(165,'14С','Любеч',250);
insert into eqm_compens35(id,kod,name,res) values(170,'15С','Малин?вка',250);
insert into eqm_compens35(id,kod,name,res) values(175,'16С','Петруш?',250);
insert into eqm_compens35(id,kod,name,res) values(180,'17С','Посьолок',250);
insert into eqm_compens35(id,kod,name,res) values(185,'18С','Осняки',320);
insert into eqm_compens35(id,kod,name,res) values(190,'18С','Осняки',250);
insert into eqm_compens35(id,kod,name,res) values(195,'19С','Замглай',250);
insert into eqm_compens35(id,kod,name,res) values(200,'20С','Городня',140);
insert into eqm_compens35(id,kod,name,res) values(205,'21С','Хоробич?',140);
insert into eqm_compens35(id,kod,name,res) values(210,'22С','Пекур?вка',140);
insert into eqm_compens35(id,kod,name,res) values(215,'23С','Тупич?в',140);
insert into eqm_compens35(id,kod,name,res) values(220,'24С','Г?рськ',140);
insert into eqm_compens35(id,kod,name,res) values(225,'24С','Г?рськ',300);
insert into eqm_compens35(id,kod,name,res) values(230,'25С','Петр?вка',300);
insert into eqm_compens35(id,kod,name,res) values(235,'26С','Щорс',300);
insert into eqm_compens35(id,kod,name,res) values(240,'27С','Седн?в',140);
insert into eqm_compens35(id,kod,name,res) values(245,'27С','Седн?в',200);
insert into eqm_compens35(id,kod,name,res) values(250,'27С','Седн?в',320);
insert into eqm_compens35(id,kod,name,res) values(255,'28С','Березна',200);
insert into eqm_compens35(id,kod,name,res) values(260,'29С','Стольне',200);
insert into eqm_compens35(id,kod,name,res) values(265,'30С','Снов'янка',320);
insert into eqm_compens35(id,kod,name,res) values(270,'31С','Кисел?вка',320);
insert into eqm_compens35(id,kod,name,res) values(275,'32С','Низьк?вка',170);
insert into eqm_compens35(id,kod,name,res) values(280,'32С','Низьк?вка',300);
insert into eqm_compens35(id,kod,name,res) values(285,'33С','Мена-1',200);
insert into eqm_compens35(id,kod,name,res) values(290,'34С','Мена-2',200);
insert into eqm_compens35(id,kod,name,res) values(295,'35С','Б?рк?вка',200);
insert into eqm_compens35(id,kod,name,res) values(300,'36С','Феськ?вка',200);
insert into eqm_compens35(id,kod,name,res) values(305,'37С','Макошине',200);
insert into eqm_compens35(id,kod,name,res) values(310,'38С','Сосниця',260);
insert into eqm_compens35(id,kod,name,res) values(315,'39С','Корюк?вка',170);
insert into eqm_compens35(id,kod,name,res) values(320,'40С','Прибинь',170);
insert into eqm_compens35(id,kod,name,res) values(325,'41С','Сядрино',170);
insert into eqm_compens35(id,kod,name,res) values(330,'42С','ЗБМ',170);
insert into eqm_compens35(id,kod,name,res) values(335,'43С','Сахут?вка',170);
insert into eqm_compens35(id,kod,name,res) values(340,'44С','Соф??вка',170);
insert into eqm_compens35(id,kod,name,res) values(345,'44С','Соф??вка',300);
insert into eqm_compens35(id,kod,name,res) values(350,'45С','ЧнТЕЦ',310);
insert into eqm_compens35(id,kod,name,res) values(355,'46С','Халявин',320);
insert into eqm_compens35(id,kod,name,res) values(360,'47С','Портова',320);
insert into eqm_compens35(id,kod,name,res) values(365,'48С','Анис?в',320);
insert into eqm_compens35(id,kod,name,res) values(370,'49С','?ван?вка',320);
insert into eqm_compens35(id,kod,name,res) values(375,'50С','Шестовиця',320);
insert into eqm_compens35(id,kod,name,res) values(380,'51С','Мохнатин',320);
insert into eqm_compens35(id,kod,name,res) values(385,'52С','Ки?нка',320);
insert into eqm_compens35(id,kod,name,res) values(390,'53С','Карх?вка',320);
insert into eqm_compens35(id,kod,name,res) values(395,'54С','Город-35',330);
insert into eqm_compens35(id,kod,name,res) values(400,'55С','М.Коцюбинськ',320);
insert into eqm_compens35(id,kod,name,res) values(405,'56С','Гончар?вськ',320);
insert into eqm_compens35(id,kod,name,res) values(410,'57С','Кулик?вка',190);
insert into eqm_compens35(id,kod,name,res) values(415,'58С','Горбове',190);
insert into eqm_compens35(id,kod,name,res) values(420,'59С','Орл?вка',190);
insert into eqm_compens35(id,kod,name,res) values(425,'60С','Жук?вка',190);
insert into eqm_compens35(id,kod,name,res) values(430,'61С','Вересоч',190);
insert into eqm_compens35(id,kod,name,res) values(435,'62С','Олиш?вка',320);
insert into eqm_compens35(id,kod,name,res) values(440,'63С','Лихач?в',210);
insert into eqm_compens35(id,kod,name,res) values(445,'63С','Лихач?в',230);
insert into eqm_compens35(id,kod,name,res) values(450,'64С','Держан?вка',230);
insert into eqm_compens35(id,kod,name,res) values(455,'65С','Мрин',230);
insert into eqm_compens35(id,kod,name,res) values(460,'66С','Неданчич?',330);
insert into eqm_compens35(id,kod,name,res) values(465,'67С','Город-110',330);
insert into eqm_compens35(id,kod,name,res) values(470,'68С','Добрянка',140);
insert into eqm_compens35(id,kod,name,res) values(475,'68С','Добрянка',250);
insert into eqm_compens35(id,kod,name,res) values(480,'69С','Олешня',250);
insert into eqm_compens35(id,kod,name,res) values(485,'70С','П?знопали',250);
insert into eqm_compens35(id,kod,name,res) values(490,'71С','Оболоння',180);
insert into eqm_compens35(id,kod,name,res) values(495,'72С','Короп',180);
insert into eqm_compens35(id,kod,name,res) values(500,'73С','Понорниця',260);
insert into eqm_compens35(id,kod,name,res) values(505,'73С','Понорниця',180);
insert into eqm_compens35(id,kod,name,res) values(510,'74С','Радич?в',180);
insert into eqm_compens35(id,kod,name,res) values(515,'75С','Свердловка',180);
insert into eqm_compens35(id,kod,name,res) values(520,'76С','Холми',170);
insert into eqm_compens35(id,kod,name,res) values(525,'76С','Холми',270);
insert into eqm_compens35(id,kod,name,res) values(530,'77С','Жадове',270);
insert into eqm_compens35(id,kod,name,res) values(535,'78С','Чорнотич?',260);
insert into eqm_compens35(id,kod,name,res) values(540,'79С','Атюша',180);
insert into eqm_compens35(id,kod,name,res) values(545,'80С','Н-С?верська',220);
insert into eqm_compens35(id,kod,name,res) values(550,'81С','Кудла?вка',220);
insert into eqm_compens35(id,kod,name,res) values(555,'82С','Печенюги',220);
insert into eqm_compens35(id,kod,name,res) values(560,'83С','Б.Гать',220);
insert into eqm_compens35(id,kod,name,res) values(565,'84С','Смяч',220);
insert into eqm_compens35(id,kod,name,res) values(570,'85С','Вороб'?вка',220);
insert into eqm_compens35(id,kod,name,res) values(575,'86С','К.Слобода',220);
insert into eqm_compens35(id,kod,name,res) values(580,'87С','Семен?вка-2',270);
insert into eqm_compens35(id,kod,name,res) values(585,'88С','Семен?вка-1',270);
insert into eqm_compens35(id,kod,name,res) values(590,'89С','Архип?вка',270);
insert into eqm_compens35(id,kod,name,res) values(595,'180С','Козелець',160);
insert into eqm_compens35(id,kod,name,res) values(600,'181С','Форнетт?',160);
insert into eqm_compens35(id,kod,name,res) values(605,'182С','Лензавод',160);
insert into eqm_compens35(id,kod,name,res) values(610,'183С','Дан?вка',160);
insert into eqm_compens35(id,kod,name,res) values(615,'184С','Остер',160);
insert into eqm_compens35(id,kod,name,res) values(620,'185С','Мор?вськ',160);
insert into eqm_compens35(id,kod,name,res) values(625,'186С','Вовчок',160);
insert into eqm_compens35(id,kod,name,res) values(630,'187С','Савин',160);
insert into eqm_compens35(id,kod,name,res) values(635,'188С','Димерка',160);
insert into eqm_compens35(id,kod,name,res) values(640,'189С','Патюти',160);
insert into eqm_compens35(id,kod,name,res) values(645,'190С','Чемер',160);
insert into eqm_compens35(id,kod,name,res) values(650,'179С','Виповз?в',160);
insert into eqm_compens35(id,kod,name,res) values(1050,'90С','Машеве',270);
insert into eqm_compens35(id,kod,name,res) values(1055,'91Ю','Н?жин-330',210);
insert into eqm_compens35(id,kod,name,res) values(1060,'91Ю','Н?жин-330',230);
insert into eqm_compens35(id,kod,name,res) values(1065,'92Ю','Безугл?вка',210);
insert into eqm_compens35(id,kod,name,res) values(1070,'93Ю','Лосин?вка',210);
insert into eqm_compens35(id,kod,name,res) values(1075,'93Ю','Лосин?вка',230);
insert into eqm_compens35(id,kod,name,res) values(1080,'94Ю','М?ська',210);
insert into eqm_compens35(id,kod,name,res) values(1085,'95Ю','Верт??вка',210);
insert into eqm_compens35(id,kod,name,res) values(1090,'96Ю','Кукшин',210);
insert into eqm_compens35(id,kod,name,res) values(1095,'97Ю','В.Кошел?вка',210);
insert into eqm_compens35(id,kod,name,res) values(1100,'98Ю','Ч.Партизани',230);
insert into eqm_compens35(id,kod,name,res) values(1105,'99Ю','Прохори',120);
insert into eqm_compens35(id,kod,name,res) values(1110,'100Ю','Сидор?вка',120);
insert into eqm_compens35(id,kod,name,res) values(1115,'100Ю','Сидор?вка',200);
insert into eqm_compens35(id,kod,name,res) values(1120,'101Ю','Комар?вка',120);
insert into eqm_compens35(id,kod,name,res) values(1125,'102Ю','Прогрес',210);
insert into eqm_compens35(id,kod,name,res) values(1130,'103Ю','НРЗ',210);
insert into eqm_compens35(id,kod,name,res) values(1135,'104Ю','Плиски',120);
insert into eqm_compens35(id,kod,name,res) values(1140,'104Ю','Плиски',150);
insert into eqm_compens35(id,kod,name,res) values(1145,'105Ю','Параф??вка',150);
insert into eqm_compens35(id,kod,name,res) values(1150,'106Ю','Мартин?вка',100);
insert into eqm_compens35(id,kod,name,res) values(1155,'106Ю','Мартин?вка',150);
insert into eqm_compens35(id,kod,name,res) values(1160,'107Ю','Крути',210);
insert into eqm_compens35(id,kod,name,res) values(1165,'108Ю','С?верна',120);
insert into eqm_compens35(id,kod,name,res) values(1170,'109Ю','Ядути',120);
insert into eqm_compens35(id,kod,name,res) values(1175,'109Ю','Ядути',200);
insert into eqm_compens35(id,kod,name,res) values(1180,'110Ю','Борзна',120);
insert into eqm_compens35(id,kod,name,res) values(1185,'111Ю','Стр?льники',100);
insert into eqm_compens35(id,kod,name,res) values(1190,'112Ю','Високе',120);
insert into eqm_compens35(id,kod,name,res) values(1195,'113Ю','Головеньки',120);
insert into eqm_compens35(id,kod,name,res) values(1200,'114Ю','Неха?вка',180);
insert into eqm_compens35(id,kod,name,res) values(1205,'115Ю','Прилуки',240);
insert into eqm_compens35(id,kod,name,res) values(1210,'116Ю','П.Сх?дна',240);
insert into eqm_compens35(id,kod,name,res) values(1215,'117Ю','М?льки',240);
insert into eqm_compens35(id,kod,name,res) values(1220,'118Ю','Агр?кор',240);
insert into eqm_compens35(id,kod,name,res) values(1225,'119Ю','Ладан',240);
insert into eqm_compens35(id,kod,name,res) values(1230,'120Ю','Галиця',210);
insert into eqm_compens35(id,kod,name,res) values(1235,'121Ю','М.Д?виця',240);
insert into eqm_compens35(id,kod,name,res) values(1240,'122Ю','Промислова-4',240);
insert into eqm_compens35(id,kod,name,res) values(1245,'123Ю','Сухополова',240);
insert into eqm_compens35(id,kod,name,res) values(1250,'124Ю','Линовиця',240);
insert into eqm_compens35(id,kod,name,res) values(1255,'125Ю','Яблун?вка',240);
insert into eqm_compens35(id,kod,name,res) values(1260,'126Ю','Б?лошапки',240);
insert into eqm_compens35(id,kod,name,res) values(1265,'127Ю','Серг??вка',240);
insert into eqm_compens35(id,kod,name,res) values(1270,'128Ю','Знам'янка',240);
insert into eqm_compens35(id,kod,name,res) values(1275,'129Ю','М'ясокомб?нат',240);
insert into eqm_compens35(id,kod,name,res) values(1280,'130Ю','Ряшки',240);
insert into eqm_compens35(id,kod,name,res) values(1285,'131Ю','Томаш?вка',150);
insert into eqm_compens35(id,kod,name,res) values(1290,'132Ю','В?льшана',150);
insert into eqm_compens35(id,kod,name,res) values(1295,'133Ю','?чня',150);
insert into eqm_compens35(id,kod,name,res) values(1300,'134Ю','Монастирище',150);
insert into eqm_compens35(id,kod,name,res) values(1305,'135Ю','Крупичполе',150);
insert into eqm_compens35(id,kod,name,res) values(1310,'136Ю','Леляки',130);
insert into eqm_compens35(id,kod,name,res) values(1315,'137Ю','Лиски',240);
insert into eqm_compens35(id,kod,name,res) values(1320,'138Ю','Ср?бне',280);
insert into eqm_compens35(id,kod,name,res) values(1325,'139Ю','?ваниця',150);
insert into eqm_compens35(id,kod,name,res) values(1330,'140Ю','Тростянець',150);
insert into eqm_compens35(id,kod,name,res) values(1335,'141Ю','Озеряни',130);
insert into eqm_compens35(id,kod,name,res) values(1340,'142Ю','Варва',130);
insert into eqm_compens35(id,kod,name,res) values(1345,'143Ю','ГПП1Гнединц?',130);
insert into eqm_compens35(id,kod,name,res) values(1350,'144Ю','ГПП2Гнединц?',130);
insert into eqm_compens35(id,kod,name,res) values(1355,'145Ю','КНСГнединц?',130);
insert into eqm_compens35(id,kod,name,res) values(1360,'146Ю','БКНСГнединц?',130);
insert into eqm_compens35(id,kod,name,res) values(1365,'147Ю','БКНСЛеляки',130);
insert into eqm_compens35(id,kod,name,res) values(1370,'148Ю','Промислова-1',130);
insert into eqm_compens35(id,kod,name,res) values(1375,'149Ю','Богдани',130);
insert into eqm_compens35(id,kod,name,res) values(1380,'150Ю','Удай',130);
insert into eqm_compens35(id,kod,name,res) values(1385,'151Ю','Промислова-2',130);
insert into eqm_compens35(id,kod,name,res) values(1390,'152Ю','Журавка',130);
insert into eqm_compens35(id,kod,name,res) values(1395,'153Ю','Бобровиця',110);
insert into eqm_compens35(id,kod,name,res) values(1400,'154Ю','Ст.Басань',110);
insert into eqm_compens35(id,kod,name,res) values(1405,'155Ю','Н.Басань',110);
insert into eqm_compens35(id,kod,name,res) values(1410,'156Ю','Н.Бик?в',110);
insert into eqm_compens35(id,kod,name,res) values(1415,'157Ю','Лукаш?вка',110);
insert into eqm_compens35(id,kod,name,res) values(1420,'158Ю','Петр?вське',160);
insert into eqm_compens35(id,kod,name,res) values(1425,'159Ю','Кобижча',110);
insert into eqm_compens35(id,kod,name,res) values(1430,'160Ю','Колом?йц?вка',230);
insert into eqm_compens35(id,kod,name,res) values(1435,'161Ю','Веприк',110);
insert into eqm_compens35(id,kod,name,res) values(1440,'162Ю','Мак??вка',230);
insert into eqm_compens35(id,kod,name,res) values(1445,'163Ю','Нос?вка',230);
insert into eqm_compens35(id,kod,name,res) values(1450,'164Ю','Трудова',230);
insert into eqm_compens35(id,kod,name,res) values(1455,'165Ю','Побед?т',230);
insert into eqm_compens35(id,kod,name,res) values(1460,'166Ю','Бахмач-1',100);
insert into eqm_compens35(id,kod,name,res) values(1465,'167Ю','Бахмач-2',100);
insert into eqm_compens35(id,kod,name,res) values(1470,'168Ю','Батурин',100);
insert into eqm_compens35(id,kod,name,res) values(1475,'168Ю','Батурин',180);
insert into eqm_compens35(id,kod,name,res) values(1480,'169Ю','Красне',100);
insert into eqm_compens35(id,kod,name,res) values(1485,'170Ю','Григор?вка',100);
insert into eqm_compens35(id,kod,name,res) values(1490,'171Ю','Дмитр?вка',100);
insert into eqm_compens35(id,kod,name,res) values(1495,'171Ю','Дмитр?вка',150);
insert into eqm_compens35(id,kod,name,res) values(1500,'172Ю','Тиниця',100);
insert into eqm_compens35(id,kod,name,res) values(1505,'173Ю','Гол?нка',100);
insert into eqm_compens35(id,kod,name,res) values(1510,'173Ю','Гол?нка',290);
insert into eqm_compens35(id,kod,name,res) values(1515,'174Ю','Кур?нь',100);
insert into eqm_compens35(id,kod,name,res) values(1520,'175Ю','Болотниця',290);
insert into eqm_compens35(id,kod,name,res) values(1525,'176Ю','Олексинц?',280);
insert into eqm_compens35(id,kod,name,res) values(1530,'176Ю','Олексинц?',290);
insert into eqm_compens35(id,kod,name,res) values(1535,'177Ю','Талала?вка-1',290);
insert into eqm_compens35(id,kod,name,res) values(1540,'178Ю','Талала?вка-2',290);



--select * from syi_sysvars_tbl where ident='kod_res'
--select * from eqi_device_kinds_tbl
-- select e.*,c.* from eqm_equipment_tbl e,eqm_compens_station_tbl c where c.code_eqp=e.id
--select * from eqm_compens35
/*
select * from 
(select e.id,2 
  from ( select * from eqm_compens35 where res=160) c 
        left join (select * from eqm_equipment_tbl where type_eqp=8 order by num_eqp) e 
        on e.num_eqp=c.kod where e.num_eqp is not null ) e
        left join eqm_compens_station_tbl c on c.code_eqp=e.id;
select * from eqm_area_tbl

*/
create or replace function repl_compens35() returns int as
'
declare pres int;
declare pkres int;
fl_ins int;
begin
pkres=syi_resid_fun();
select into fl_ins eqt_change_fun(2,null,null,null,null,0); 
select into pres value_ident from syi_sysvars_tbl where ident=''kod_res'';
insert into eqm_equipment_tbl  (type_eqp,num_eqp,name_eqp,dt_install) 
  select 8,kod,kod||'' ''||name,''2004-01-01''
  from ( select * from eqm_compens35 where res=pres) c 
              left join (select * from eqm_equipment_tbl where type_eqp=8 order by num_eqp) e on e.num_eqp=c.kod where e.num_eqp is null;   

insert into eqm_compens_station_tbl (code_eqp,id_voltage) 
select id, volt from 
(select e.id,2 as volt
  from ( select * from eqm_compens35 where res=pres) c 
        left join (select * from eqm_equipment_tbl where type_eqp=8 order by num_eqp) e 
        on e.num_eqp=c.kod where e.num_eqp is not null ) e
        left join eqm_compens_station_tbl c on c.code_eqp=e.id;

insert into eqm_area_tbl (code_eqp,id_client) 
select id, pkres from 
(select e.id 
  from ( select * from eqm_compens35 where res=pres) c 
        left join (select * from eqm_equipment_tbl where type_eqp=8 order by num_eqp) e 
        on e.num_eqp=c.kod where e.num_eqp is not null ) e
        left join eqm_compens_station_tbl c on c.code_eqp=e.id;

return 1;
end
' language 'plpgsql';


select crt_ttbl();
select repl_compens35()


